# ???????? API ??

## 1. ????

- ????React 18?TypeScript?Vite?Ant Design 5?Zustand?ECharts?
- ?????`@` ?? `src` ????? `vite.config.ts` ? `tsconfig.json`?
- ?????
  - ?????`npm install`
  - ?????`npm run dev`
  - ?????`npm run build`
  - ?????`npm run preview`

??????? `stock-sim/` ???????????????API ?????????????

## 2. ??????

- `src/main.tsx`????????? Ant Design ???
- `src/App.tsx`???????????
- `src/components/`????????????????
- `src/pages/`???????????????
- `src/stores/useStockStore.ts`????????Zustand + immer??
- `src/types/stock.ts`????????
- `src/utils/`???????????????

## 3. ?????`src/types/stock.ts`?

| ?? | ?? | ???? |
| --- | --- | --- |
| `Stock` | ?????????? | `code` ?????`name` ???`currentPrice` ????`change` ???(%)?`volume` ??? |
| `KLineData` | ? K ???? | `date` ??(yyyy-MM-dd)?`open`?`close`?`high`?`low`?`volume` |
| `Transaction` | ???? | `type` ?/??`price` ????`quantity` ???`timestamp` ISO ?? |
| `Position` | ?? | `quantity` ????`costPrice` ????? |
| `TimePoint` | ????? | `time` HH:mm?`price` ????`avg` ???`vol` ??? |

?????????????????????????????

## 4. ????

### 4.1 ?????`src/utils/mockData.ts`?

| ?? | ?? | ?? | ?? |
| --- | --- | --- | --- |
| `generateStocks(count = 25)` | `count` ???? | `Stock[]` | ??????????????????????? |
| `generateKline(days = 90, basePrice = 30)` | `days` ?????`basePrice` ??? | `KLineData[]` | ????? K ?????????? |
| `generateTransactions(count = 10)` | `count` ???? | `Transaction[]` | ?????????? |
| `generateIntradaySeries(basePrice, minutes = 120)` | `basePrice` ???????`minutes` ???? | `TimePoint[]` | ??????????????? |
| `nextIntradayTick(prev, lastPrice)` | `prev` ?????`lastPrice` ??? | `{ series, price }` | ?????????????????????? |

#### ????

```ts
import { generateStocks, generateKline } from '@/utils/mockData';

const stocks = generateStocks(50);
const first = stocks[0];
const kline = generateKline(180, first.currentPrice);
```

> ??????????????????????????????????????????????????????

### 4.2 ?????`src/utils/calculation.ts`?

| ?? | ?? | ?? | ?? |
| --- | --- | --- | --- |
| `calculateAmount(price, quantity)` | ?????? | `number` | ????????????? |
| `calculateFee(amount)` | ?? | `number` | ? 0.1% ??????? |
| `formatCurrency(value)` | ?? | `string` | ?????????????? |

#### ????

```ts
import { calculateAmount, calculateFee, formatCurrency } from '@/utils/calculation';

const amount = calculateAmount(18.56, 300);
const fee = calculateFee(amount);
const summary = `${formatCurrency(amount)} / ??? ${formatCurrency(fee)}`;
```

## 5. ?????`src/stores/useStockStore.ts`?

### 5.1 ????

- `balance: number`?????????? 100,000?
- `positions: Position[]`??????
- `transactions: Transaction[]`??????????????
- `stockList: Stock[]`???????????????????
- `currentStock: Stock | null`?????????
- `klineData: KLineData[]`????????? K ???
- `intradayMap: Record<string, TimePoint[]>`???????????
- `openPriceMap: Record<string, number>`???????????????

### 5.2 ??????

| ?? | ?? | ?? |
| --- | --- | --- |
| `init()` | ???????????????????? | - ??????????<br>- ????????<br>- ?? 1 ???????????????????<br>- ??????????????? |
| `setCurrentStock(code)` | ??????????? K ? | ??????????????? 90 ? K ??? |
| `buyStock(code, quantity)` | ??????? | - ???????<br>- ??????????<br>- ???????? |
| `sellStock(code, quantity)` | ???? | - ??????<br>- ??????????<br>- ????????? |

### 5.3 ????

```ts
import { useStockStore } from '@/stores/useStockStore';

function BalanceIndicator() {
  const balance = useStockStore((state) => state.balance);
  return <span>??????{balance.toFixed(2)}</span>;
}

function ManualInitButton() {
  const init = useStockStore((state) => state.init);
  return <button onClick={init}>??????</button>;
}
```

???????? `useStockStore()` ??????????? React ???????????? `useStockStore.getState()` ? `useStockStore.setState()`?

## 6. UI ??

### 6.1 ????

#### `MainLayout`?`src/components/layout/MainLayout.tsx`?

- **Props**
  - `activeKey: string`????? key?`market` / `trade` / `history`??
  - `onChange(key: string)`????????
  - `children: ReactNode`???????
- **??**??? Ant Design `Layout` ? `Menu` ??????????????
- **????**

```tsx
<MainLayout activeKey={activeKey} onChange={setActiveKey}>
  {/* ???? */}
</MainLayout>
```

### 6.2 ????

#### `KLineChart`?`src/components/charts/KLineChart.tsx`?

- **Props**?`data: KLineData[]`
- **??**?
  - ???? MA5/MA10/MA20 ???
  - ??????? K ????????
  - ???? `resize` ???????
- **??**

```tsx
import { KLineChart } from '@/components/charts/KLineChart';

<KLineChart data={klineData} />
```

#### `TimeSharingChart`?`src/components/charts/TimeSharingChart.tsx`?

- **Props**?`data: TimePoint[]`
- **??**?
  - ?????????????????
  - ?????????????
- **??**

```tsx
import { TimeSharingChart } from '@/components/charts/TimeSharingChart';

<TimeSharingChart data={intradaySeries} />
```

> ??????????????? `window` ???? SSR ???????????????

### 6.3 ????

#### `TradePanel`?`src/components/trade/TradePanel.tsx`?

- **Props**??????? `useStockStore`??
- **??**?
  - ???? / ??????????
  - ?????????????????
  - ????????? / ?????
  - ?????????????????????????
- **????**?????????????????

#### `PositionList`?`src/components/trade/PositionList.tsx`?

- **Props**????????????????
- **??**?Ant Design `Table` ???????????????

## 7. ????

### `MarketPage`?`src/pages/MarketPage.tsx`?

- ????????? `init()` ???????
- ??????????????
- ?????????????

### `TradePage`?`src/pages/TradePage.tsx`?

- ?? K ?????????????
- ??????? `init()` ???????

### `HistoryPage`?`src/pages/HistoryPage.tsx`?

- ?? `DatePicker` ??????????
- ???????????????? 10 ???

> ????????? `useStockStore`???????????????`init()` ????????????????

## 8. ????

- `src/App.tsx`?????????? key????????? `MainLayout` ??????
- `src/main.tsx`?
  - ?? `ReactDOM.createRoot` ??? `#root`?
  - ???? `React.StrictMode`??????????????
  - ?? Ant Design `ConfigProvider` ????????????? `antd/dist/reset.css` ? `src/styles.css`?

## 9. ????

- **????**?? `mockData` ???? API ???? `useStockStore` ? `init()` ???????????????????????
- **SSR / CSR ??**??????????? `useEffect` ???????????????????
- **???**???????????????? `formatCurrency` ?? `Intl.NumberFormat` ?????????
- **?????**??????????????? `destroy()` ?????? `setInterval`??????????????

## 10. ??????

- ???`import { Stock, KLineData, Transaction, Position, TimePoint } from '@/types/stock';`
- ???`import { generateStocks, calculateAmount, formatCurrency } from '@/utils';`
- ???`const { stockList, buyStock } = useStockStore();`
- ???`<KLineChart data={klineData} />`?`<TimeSharingChart data={intraday} />`
- ???`<MarketPage />`?`<TradePage />`?`<HistoryPage />`

???????????? API????????????????????????????????????????

